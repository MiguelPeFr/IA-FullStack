

SELECT calls_ivr_id, calls_phone_number, calls_start_date, 

LAG(calls_start_date) OVER(PARTITION BY calls_phone_number ORDER BY calls_start_date ASC),

DATETIME_DIFF(LAG(calls_start_date) OVER(PARTITION BY calls_phone_number ORDER BY calls_start_date ASC), calls_start_date, HOUR) ,
DATETIME_DIFF(LEAD(calls_start_date) OVER(PARTITION BY calls_phone_number ORDER BY calls_start_date ASC), calls_start_date, HOUR) ,

 IF(DATETIME_DIFF(LAG(calls_start_date) OVER(PARTITION BY calls_phone_number ORDER BY calls_start_date ASC), calls_start_date, HOUR) >= -24, 1, 0)  AS previous_call,

  IF(DATETIME_DIFF(LEAD(calls_start_date) OVER(PARTITION BY calls_phone_number ORDER BY calls_start_date ASC), calls_start_date, HOUR) <= 24, 1, 0)  AS next_call
